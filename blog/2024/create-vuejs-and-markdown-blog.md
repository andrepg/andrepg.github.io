---
title: Como constru√≠ este blog em VueJS + Markdown puro!
published: true
published_at: 2024-12-18
tags:
  - development
  - software
  - git
  - vuejs
  - markdown
serie: Um blog feito em casa
category:
  - Programa√ß√£o
excerpt: Depois de in√∫meras tentativas de construir e manter um blog, decidi reinventar a roda e manter a minha pr√≥pria aplica√ß√£o.
---
# üí°Introdu√ß√£o

> üü® O texto a seguir √© razoavelmente t√©cnico e pressup√µe um conhecimento b√°sico de programa√ß√£o. Alguns documentos e links s√£o oferecidos como refer√™ncia, al√©m de todo o c√≥digo do [meu reposit√≥rio GitHub](https://github.com/andrepg/andrepg.github.io). 


Come√ßamos pelas raz√µes e objetivos principais: *ter um blog simples, junto ao meu cart√£o de visitas online*. Muitas tentativas foram feitas: Jekyll, HTML b√°sico, WordPress, VueJS. Por fim, resolvi seguir o caminho do SPA VueJS e Markdown. Algumas circunst√¢ncias foram importantes para esta decis√£o e, no futuro, est√£o pass√≠veis de revis√£o: 

1. A hospedagem inicial √© feita pelo GitHub Pages e, portanto, n√£o h√° banco de dados
2. J√° existia um SPA com meu cart√£o de visitas, e o VuePress parecia complexo para ado√ß√£o em projetos existentes
3. Sem banco de dados √© imposs√≠vel construir algo com WordPress ‚Äî e s√£o recursos demais para um simples blog.
4. O uso do SPA + GitHub me permitiu ter os arquivos em Markdown (e j√° os escrevo no Obsidian neste mesmo formato)

# üõ† Pacotes para instalar
Algumas depend√™ncias e pacotes s√£o b√°sicas para o funcionamento do framework; aprofundar neste quesito n√£o √© o foco do artigo. Vale a pena mencionar, no entanto. Isso d√° contexto a diferentes classes e configura√ß√µes utilizadas ao longo deste texto.

## O b√°sico para come√ßar
Aqui temos a composi√ß√£o da espinha dorsal do projeto, com suas respectivas p√°ginas de documenta√ß√£o. Minha recomenda√ß√£o √© ler com aten√ß√£o as documenta√ß√µes e instru√ß√µes de cada uma destas para ambientar-se no projeto.

* [Vite](https://vite.dev/)
* [VueJS](https://vuejs.org/) e [Vue Router](https://router.vuejs.org/)
* [Tailwind CSS](https://tailwindcss.com/)
* [Node](https://nodejs.org/) e [Yarn](https://yarnpkg.com/) (ou NPM se preferir)

## O plugin para ler Markdown
üåê https://www.npmjs.com/package/vite-plugin-markdown

Com um papel importante no projeto, o plugin Vite Markdown permite a importa√ß√£o de arquivos `.md` e seus atributos de *FrontMatter* ([üîç pesquise um pouco](https://www.google.com/search?q=atributos+frontmatter)). Estes atributos permitem categorizar, definir t√≠tulos, datas e outras informa√ß√µes √∫teis para a renderiza√ß√£o. 

Para instalar o plugin, basta um comando: `yarn add vite-plugin-markdown`. As configura√ß√µes faremos depois, no arquivo espec√≠fico alguns par√°grafos √† frente. 

## O plugin para formatar c√≥digo-fonte
üåê https://prismjs.com/

Existe um conceito chamado **[üîç Codefence](https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/creating-and-highlighting-code-blocks)**: um trecho de c√≥digo formatado especialmente, conforme a linguagem, para facilitar a leitura do c√≥digo. Este comportamento envolve muito c√≥digo para reinventar a roda. Assim, a decis√£o foi por adotar uma extens√£o para esta formata√ß√£o.

O PrismJS inclui os arquivos JavaScript, folhas de estilo, e outras necessidades para correta formata√ß√£o, gerando o c√≥digo visto na se√ß√£o **[[#Configura√ß√µes do Vite]]**. Algumas personaliza√ß√µes foram necess√°rias e est√£o dispon√≠veis no arquivo [üìö settings.jsx](https://github.com/andrepg/andrepg.github.io/blob/main/src/data/settings.jsx) do reposit√≥rio.

S√£o detalhes relacionados a linguagens suportadas pela extens√£o, bem como adicionais de formata√ß√£o, numera√ß√£o e outros.

## Configura√ß√µes do Vite
Extens√µes instaladas, agora as configura√ß√µes: para `Markdown` e `PrismJS`. O trecho abaixo ativa os modos HTML, <abbr title="Tabela de conte√∫do">TOC</abbr> e Vue para leitura de arquivos `.md`.

```javascript
	// mais em https://github.com/andrepg/andrepg.github.io/blob/main/vite.config.js
    markdown({
      mode: [Mode.HTML, Mode.TOC, Mode.VUE]
    }),
```

J√° este trecho permite configurar o PrismJS com inje√ß√£o de CSS, tema e linguagens, configurados anteriormente no `settings.jsx`.

```js
    prismjsPlugin({
      css: true,
      theme: 'tomorrow',
      languages: PrismJsLanguages,
      plugins: PrismJsPlugins
    })
```

Com isto √© poss√≠vel integrar tudo que instalamos e avan√ßar para a m√£o no c√≥digo. 

> üü° Fique atento! Nesta fase ainda n√£o √© poss√≠vel ver nenhum tipo de integra√ß√£o funcionando. Apenas instala√ß√£o e configura√ß√µes foram feitas.

# üìù A p√°gina inicial

> Esta se√ß√£o serve apenas para apresentar meu website, e introduzir um pouco da estrutura b√°sica. Se preferir, voc√™ pode pular para a se√ß√£o [[#üìù A estrutura de blog]]

Seguindo os passos de um desenvolvimento natural de website, o ponto de partida √© a **p√°gina inicial**. Um desenho b√°sico (que pode ser visto [aqui](https://andrepg.github.io)). Esta p√°gina est√° constru√≠da em VueJS e Tailwind, utilizando conceitos b√°sicos. Tamb√©m n√£o entrarei em muitos detalhes, apenas dois: a gera√ß√£o autom√°tica de se√ß√µes:

## Os bot√µes & se√ß√µes adicionais
Para renderizar alguns bot√µes e redirecionar o visitante (j√° que esta p√°gina serve apenas para isto) existe a estrutura de leitura de objetos simples e renderiza√ß√£o de bot√µes. O arquivo [üìö homepageLinks](https://github.com/andrepg/andrepg.github.io/blob/main/src/data/homepageLinks.js) possui configura√ß√µes para cada um dos bot√µes renderizados. Cada bot√£o tem as seguintes propriedades:

```json
{
	label: 'GitHub',
	icon: 'hugeicons:github',
	target: 'https://github.com/andrepg'
}
```

E para renderizar os bot√µes, utilizamos o seguinte c√≥digo na [HomeView.vue](https://github.com/andrepg/andrepg.github.io/blob/db998354a4bcd5cc123bd10aaf9c954494f1db97/src/views/HomeView.vue):

```jsx
<PrimaryButton 
	v-for="button in HomepageLinks" 
	:key="button.target"
    :icon="button.icon" 
    :target="button.target">
    {{ button.label }}
</PrimaryButton>
```

Com isto conseguimos a estrutura de gerar bot√µes e adicionar quantos necess√°rios, sem a que seja preciso modificar o c√≥digo a cada novo link. Estas modifica√ß√µes s√£o feitas no arquivo `homepageLinks.js`.

---
# üìù A estrutura de blog,

Uma vez com extens√µes instaladas, configura√ß√µes feitas e uma p√°gina inicial capaz de ler um conte√∫do b√°sico, partimos para a estrutura do blog e outras cria√ß√µes para possibilitar isto.

No in√≠cio comentei que parecia trabalho demais instalar o VitePress. Isso porque n√£o pude encontrar nenhuma documenta√ß√£o clara suficiente sobre o assunto, apenas sobre instala√ß√µes em sub-p√°ginas, separadas. Isso traz a obriga√ß√£o de ter um pipeline a mais, e cria mais complexidade para o projeto.

Copiando estruturas b√°sicas de outros sistemas de blog, a decis√£o foi feita em prol de uma pasta `blogs`, contendo os artigos agrupados por ano. Assim, seria poss√≠vel organizar melhor o reposit√≥rio (j√° que a frequ√™ncia de postagens n√£o √©, assim, t√£o grande). A estrutura de pastas ficaria:

```
blogs
|
 \_[ 2024 ]
  |--- artigo-1.md
  |--- artigo-2.md
  |--- artigo-3.md
 /
 \_[ 2023 ]
  |--- artigo-1.md
  |--- artigo-2.md
  |--- artigo-3.md
```

Com esta estrutura em mente, √© preciso lembrar que um blog tem certos requisitos b√°sicos para existir: um mapa de links, um √≠ndice, uma p√°gina de post e uma busca. Os recursos ser√£o constru√≠dos ao longo do tempo e fazem parte da evolu√ß√£o natural do projeto.

## Publica√ß√µes e organiza√ß√µes

Seguindo a premissa de pastas e requisitos, o primeiro passo seria a constru√ß√£o do sitemap, respons√°vel por alimentar tanto o √≠ndice quanto rob√¥s leitores de conte√∫do. Em dois formatos: JSON e XML. Fazer esse controle manual √© humanamente imposs√≠vel depois de alguns poucos artigos. Automatizar √© a chave.

## Sitemap
> üìö  [`Sitemap Generator`](https://github.com/andrepg/andrepg.github.io/blob/main/src/SitemapGenerator.js) e gatilho [`sitemap.js`](https://github.com/andrepg/andrepg.github.io/blob/main/src/sitemap.js)

Para a constru√ß√£o do mapa, a premissa √© b√°sica: ler as pastas e arquivos dentro de `blog` e gerar os arquivos necess√°rios. Em partes, o `sitemap.js` tem um ponto de entrada `main()`, respons√°vel pelos processos b√°sicos. Para fins de apresenta√ß√£o, n√£o h√° coment√°rios e registros de log. 

```js
function main() {
	let references = getArticlesList()	
	references.forEach(readArticleProperties)	
	
	writeFileSync(__sitemapJson, JSON.stringify(sitemap), { encoding: 'utf-8' })
	sitemap = generateSitemap(sitemap)	
	writeFileSync(__sitemap, sitemap, { encoding: 'utf-8' })
}
```

Informa√ß√µes b√°sicas: `writeFileSync` √© uma fun√ß√£o espec√≠fica da plataforma para escrever arquivos no sistema. Estas duas linhas geram os arquivos XML e JSON, baseadas em seus pr√≥prios par√¢metros. Nesta configura√ß√£o, os arquivos ser√£o exportados para `/public` no projeto. As fun√ß√µes `generateSitemap` e o combo `getArticlesList`/`readArticleProperties` est√£o no mesmo arquivo.

Estas tr√™s tem fun√ß√µes muito espec√≠ficas:
* [`getArticlesList`](https://github.com/andrepg/andrepg.github.io/blob/db998354a4bcd5cc123bd10aaf9c954494f1db97/src/sitemap.js#L21) busca os arquivos na pasta de blog, somente arquivos
* [`readArticleProperties`](https://github.com/andrepg/andrepg.github.io/blob/db998354a4bcd5cc123bd10aaf9c954494f1db97/src/sitemap.js#L33-L42) faz a leitura do arquivo `.md` e implementa as propriedades do FrontMatter 
* [`generateSitemap`](https://github.com/andrepg/andrepg.github.io/blob/db998354a4bcd5cc123bd10aaf9c954494f1db97/src/sitemap.js#L25-L27) utiliza a classe `SitemapGenerator` para estruturar a vers√£o XML do mapa

Este calhama√ßo de informa√ß√£o fica armazenado numa vari√°vel global `sitemap`, inicializada como um `array` vazio, logo no in√≠cio do c√≥digo. Esta vari√°vel √© a mesma que aparece no corpo da `main()`, exportada pelo `writeFileSync` ‚Äî note que `__sitemapJson` e `__sitemap` s√£o outras vari√°veis, contendo o caminho de exporta√ß√£o dos arquivos.

## Post Index
üåê https://github.com/andrepg/andrepg.github.io/blob/main/src/views/PostIndex.vue

Para o √≠ndice de postagens, metade do servi√ßo j√° foi feito. A constru√ß√£o do mapa em formato JSON permite leitura nesta p√°gina, e oferece informa√ß√£o suficiente para montagem da interface de usu√°rio. Para cumprir esta tarefa, apenas uma requisi√ß√£o simples:

```jsx
// Fetch do arquivo Sitemap.json, direto da raiz do site
const fetchPosts = () => fetch('/sitemap.json')
  .then(response => processPosts(response))

// Processamento da resposta da requisi√ß√£o e leitura
const processPosts = (response: Response) => response.json()
  .then(sitemap => posts.value = sitemap)
```

Note duas fun√ß√µes diferentes: a `fetchPosts` e a `processPosts`. Isso porque `response.json()` retorna um objeto `Promise`, que n√£o permite a leitura imediata. Para evitar um aninhamento de `.then` no c√≥digo, dividir a responsabilidade parece boa ideia. 

Ao final, o valor de `sitemap` atribu√≠do a `posts.value` conter√° o mapa completo do site, conforme gerado pela automatiza√ß√£o. Este arquivo √© p√∫blico aqui no site, e qualquer um pode [consult√°-lo aqui](https://github.com/andrepg/andrepg.github.io/blob/main/src/sitemap.js). Na renderiza√ß√£o, qualquer layout √© poss√≠vel, baseando uma itera√ß√£o sobre cada post obtido.

Assim, uma listagem de artigos √© poss√≠vel com poucas linhas de c√≥digo e um componente extra recebendo informa√ß√µes da postagem, como o [`PostListElement`](https://github.com/andrepg/andrepg.github.io/blob/main/src/components/PostListElement.vue) e sua aplica√ß√£o no [√≠ndice de artigos](https://github.com/andrepg/andrepg.github.io/blob/db998354a4bcd5cc123bd10aaf9c954494f1db97/src/views/PostIndex.vue#L44-L48).

## Post Single
üåê https://github.com/andrepg/andrepg.github.io/blob/main/src/views/PostSingle.vue

O `PostSingle` √© o componente onde a m√°gica acontece. Nele ocorre a leitura de cada artigo deste blog e a renderiza√ß√£o de todos os componentes necess√°rios. Na verdade, a m√°gica est√° toda por baixo do cap√¥. Aqui o trabalho √© feito _quase todo_ pelo [[#O plugin para ler Markdown|vite-plugin-markdown]].

```javascript
import { nextTick, onMounted } from 'vue';
import Prism from 'prismjs';

onMounted(async () => {
  Prism.manual = true;

  content.value = await import(`@blog/${year}/${article}.md`);

  nextTick(() => {
    Prism.highlightAll()
  })
})
```


```javascript
<ul class="flex flex-row flex-wrap gap-2 py-2 px-0">
	<BadgeElement v-for="tag in content.attributes.tags" key="tag">
		{{ tag }}
	</BadgeElement>
</ul>

<h1 class="text-3xl font-semibold flex flex-col max-w-[70w]">
	<span class="font-serif"> {{ content.attributes.titulo }}</span>
	<small class="w-full font-normal text-base leading-snug flex-1">
		{{ content.attributes.serie }}
	</small>
</h1>

<ul>{{ content.attributes.categories }}</ul>
```

# üü° A limita√ß√£o do GitHub Pages

Antes de continuar, preciso deixar um aviso: o GitHub Pages tem problema com aplica√ß√µes SPA e redirecionamentos para rotas. Um pequeno *hack* √© necess√°rio para funcionar corretamente. **O que acontece**: caso n√£o exista um arquivo HTML com o mesmo nome (`minha-url-buscada`) o GitHub retorna um erro 404 do servidor. 

Para contornar este problema, √© preciso criar um arquivo 404.html customizado e verificar se um redirecionamento √© necess√°rio. Este passo √© **muito** importante. E eu coletei algumas refer√™ncias sobre o assunto para aprofundar a pesquisa depois:

* üìö [W3C: Using meta refresh to create an instant client-side redirect](https://www.w3.org/TR/WCAG20-TECHS/H76.html)
* üìö [What is meta refresh?](https://help.ahrefs.com/en/articles/2433739-what-is-meta-refresh-redirect-and-why-is-it-considered-a-critical-issue)
* üìö [Fragmento CodePen](https://codepen.io/akashrajendra/pen/JKKRvQ)
* üåê [Single page hack with GitHub Pages](https://www.smashingmagazine.com/2016/08/sghpa-single-page-app-hack-github-pages/)
* üåê [Modelo de arquivo 404 - 1](https://github.com/csuwildcat/sghpa/blob/master/index.html)
* üåê [Modelo de arquivo 404 - 2](https://gist.github.com/leonsilicon/1278d429d7c915a9866bc6ea73453d9a)

## O c√≥digo que importa
üìö https://github.com/andrepg/andrepg.github.io/blob/main/public/404.html

Para resumir, o c√≥digo mais importante √© o trecho abaixo:

```js
const resource = location.href;

if (resource.includes('blog')) {  
  sessionStorage.redirect = resource  
  
  refresh = document.createElement('meta')  
  refresh.content = '0;URL=\'/\''  
  refresh.httpEquiv = 'refresh'  
  
  document.head.append(refresh)  
}
```

Estas linhas s√£o respons√°veis por verificar se a URL visitada cont√©m o fragmento `blog` e executar uma s√©rie de a√ß√µes necess√°rias:

1. Salva a URL atual na sess√£o para consulta futura
2. Cria um elemento `meta` para gerenciar o documento
3. Atribui `/` como destino do redirecionamento, com tempo de 0 segundos
4. Atribui `refresh` √† propriedade `httpEquiv`, para informar ao navegador a raz√£o desta tag
5. Adiciona ao documento ao cabe√ßalho da p√°gina

Quando esta tag `meta` √© adicionada ao cabe√ßalho o navegador poder√° interpretar a ordem de redirecionamento e processar a URL do blog. 

# üíº O projeto final

O projeto em sua forma final √© este, no qual o artigo foi publicado. Perdi as contas de quantas vezes tentei come√ßar um blog e n√£o foi adiante. Os problemas eram in√∫meros: n√£o gostava do dom√≠nio ou da ferramenta (al√¥ WordPress), perdia o banco de dados, a hospedagem vencia, ou pregui√ßa.

Agora tenho meus arquivos em Markdown onde escrevo ‚Äî no Obsidian ‚Äî e publico no meu reposit√≥rio GitHub. Assim, tenho hist√≥rico e duplo backup para meus artigos publicados. Algumas considera√ß√µes existem, pois ainda h√° tarefas pendentes.

Elas est√£o listadas abaixo, e ser√£o atualizadas √† medida que forem conclu√≠das. Por enquanto, fico por aqui, e agrade√ßo a leitura caso tenha chegado ao final com aten√ß√£o. üòÑ

## Minhas considera√ß√µes 

Ainda falta para chegar onde quero. Melhorias para implementar e corre√ß√µes a serem feitas. Minha lista e este artigos ser√£o atualizados com o tempo. Estes problemas ser√£o rastreados atrav√©s do painel de *issues* do reposit√≥rio tamb√©m.

- [ ] O rodap√© n√£o aparece na p√°gina `404`, tirando-a do padr√£o do website
- [ ] O redirecionamento `404 meta-refresh` para qualquer outra p√°gina causa uma piscadela durante o carregamento (em parte pelo rodap√© n√£o existente e a falta de um *loading*)
- [ ] Uma transi√ß√£o entre as p√°ginas seria bem-vinda
- [ ] Um carregamento antecipado da imagem de perfil pode acelerar a p√°gina
- [ ] Busca com Algolia ou outro mecanismo Javascript local 
- [ ] Postagens mais recentes na p√°gina inicial do site
- [ ] Adaptar os cart√µes da p√°gina inicial para modo escuro
